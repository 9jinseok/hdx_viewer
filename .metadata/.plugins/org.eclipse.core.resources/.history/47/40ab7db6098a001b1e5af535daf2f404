package application;

import java.io.File;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.Button;
import javafx.scene.control.TextField;
import javafx.stage.FileChooser;
import javafx.stage.Stage;

public class FileSelectViewController {

	private String[] filePaths = new String[4];
	
    private FileChooser.ExtensionFilter extFilter = 
    		new FileChooser.ExtensionFilter("MZXML FILES (*.mzxml)", "*.mzxml");
	
    @FXML
    private Button confirm_button;

    @FXML
    private Button control_button;

    @FXML
    private TextField control_field;

    @FXML
    private Button f1_button;

    @FXML
    private TextField f1_field;

    @FXML
    private Button f2_button;

    @FXML
    private TextField f2_field;

    @FXML
    private Button f3_button;

    @FXML
    private TextField f3_field;

    @FXML
    void onConfirm(ActionEvent event) {
    	try {
    	Node node = (Node) event.getSource();
    	Stage thisStage = (Stage) node.getScene().getWindow();
    	
    	String[] filePaths = new String[4];
    	filePaths[0] = control_field.getText();
    	filePaths[1] = f1_field.getText();
    	filePaths[2] = f2_field.getText();
    	filePaths[3] = f3_field.getText();
    	
    	if (filePaths[0] == "") {
    		throw new Exception("하하하");
    	}
    	
    	Main.mainViewController.setTreeItem(filePaths);

    	thisStage.close();
    	} catch(Exception e) {
    		Alert alert = new Alert(AlertType.WARNING);
    		alert.setTitle("오류가 발생했습니다.");
    		alert.setHeaderText("파일을 읽어오는데 실패했습니다.");
    		alert.setContentText(e.getMessage());

    		alert.showAndWait();
    	}
    }
    
    void selectFile(FileChooser.ExtensionFilter filter, TextField field, int index) {
    	Stage stage = Main.getPrimaryStage();
    	
    	FileChooser fileChooser = new FileChooser();
		fileChooser.setTitle("Open File");
		
		// Set extension filter
        fileChooser.getExtensionFilters().add(filter); 
        
		File file = fileChooser.showOpenDialog(stage);
		if (file != null) {
			this.filePaths[index] = file.getPath();
			field.setText(file.getName());
		}
    }
    
    @FXML
    void onSelectControlFile(ActionEvent event) {
    	selectFile(extFilter, control_field, 0);
    }

    @FXML
    void onSelectF1File(ActionEvent event) {
    	selectFile(extFilter, f1_field, 1);
    }

    @FXML
    void onSelectF2File(ActionEvent event) {
    	selectFile(extFilter, f2_field, 2);
    }

    @FXML
    void onSelectF3File(ActionEvent event) {
    	selectFile(extFilter, f3_field, 3);
    }

}