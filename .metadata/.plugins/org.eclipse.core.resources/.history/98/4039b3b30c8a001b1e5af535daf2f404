package application;

import java.io.File;
import java.io.FileNotFoundException;
import java.net.URL;
import java.util.ArrayList;
import java.util.ResourceBundle;

import javax.xml.stream.XMLStreamException;

import org.systemsbiology.jrap.stax.MSXMLSequentialParser;
import org.systemsbiology.jrap.stax.Scan;

import application.table.Person;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.chart.BarChart;
import javafx.scene.chart.LineChart;
import javafx.scene.chart.XYChart;
import javafx.scene.control.Button;
import javafx.scene.control.MenuItem;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TreeItem;
import javafx.scene.control.TreeView;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.input.MouseEvent;
import javafx.stage.FileChooser;
import javafx.stage.Modality;
import javafx.stage.Stage;

public class MainViewController implements Initializable {
	
	private ArrayList<File> files = new ArrayList<File>();

    @FXML
    private MenuItem open;

    @FXML
    private TreeView<String> treeview;

    @FXML
    private LineChart<?, ?> linechart;

    @FXML
    private BarChart<?, ?> barchart_up;
    
    @FXML
    private Button peptide_view;

    @FXML
    private BarChart<?, ?> barchart_down;

    @FXML
    private TableView<Person> tableview;

    @FXML
    void onClickOpen(ActionEvent event) {
    	Stage stage = Main.getPrimaryStage();
    	showFileModal(stage);
    }
    
    private void showFileModal(Stage parentStage) {
    	try {
    	Stage stage = new Stage();
        Parent root = FXMLLoader.load(getClass().getResource("FileSelectView.fxml"));
        stage.setScene(new Scene(root, 600, 400));
        stage.setTitle("file select");
        stage.initModality(Modality.WINDOW_MODAL);
        stage.initOwner(parentStage);
        stage.showAndWait();
    	}
    	catch(Exception e){
    		System.out.println(e);
    	}
    }

    @FXML
    void onClickTableView(MouseEvent event) {

    }

	@Override
	public void initialize(URL arg0, ResourceBundle arg1) {
		Main.mainViewController = this;
		barchart_up.setLegendVisible(false);
		barchart_up.getXAxis().setAnimated(false);
		barchart_up.getYAxis().setAnimated(false);
		barchart_down.setLegendVisible(false);
		barchart_down.getXAxis().setAnimated(false);
		barchart_down.getYAxis().setAnimated(false);
		
		treeview.getSelectionModel().selectedItemProperty().addListener((observable, oldValue, newValue) -> {
    	    if(newValue != null && newValue.getValue() != "FILES" && newValue.getValue() != "condition" && newValue != oldValue){
    	    	String fileName = newValue.getValue();
    			String filePath = "";
    			System.out.println(files.get(0).getName());
    			System.out.println(fileName);
    			for (int i = 0; i < files.size(); i++) {
    				if (files.get(i).getName() == fileName) {
    					filePath = files.get(i).getPath();
    				}
    			}
    			System.out.println("filePath"+filePath);
    			
//	    	   try {
//	    	    	MSXMLSequentialParser parser = new MSXMLSequentialParser();
//					parser.open(filePath);
//					
//					Scan scan = parser.getNextScan();
//	
//					double[][] array = scan.getMassIntensityList();
//					XYChart.Series data = new XYChart.Series();
//					
//					for (int j = 0; j < array[0].length; j++) {
//						double key = array[1][j];
//						String s = String.format("%.2f", key);
//						double value = array[0][j];
//						data.getData().add(new XYChart.Data(s, value));
//					}	
//	
//					barchart_up.getData().add(data);
//				} catch (FileNotFoundException | XMLStreamException e) {
//				}
    	    }
    	});
	}
	
	public void setTableViewData() {
		TableColumn<Person, String> column1 = new TableColumn<>("First Name");
	    column1.setCellValueFactory(new PropertyValueFactory<>("firstName"));


	    TableColumn<Person, String> column2 = new TableColumn<>("Last Name");
	    column2.setCellValueFactory(new PropertyValueFactory<>("lastName"));

		tableview.getColumns().remove(0);
		tableview.getColumns().remove(0);

	    tableview.getColumns().add(column1);
	    tableview.getColumns().add(column2);

	    tableview.getItems().add(new Person("John", "Doe"));
	    tableview.getItems().add(new Person("Jane", "Deer"));
	}
	
	public void setTreeItem(ArrayList<File> files) {
		try {
			this.files = files;
			TreeItem<String> Root = new TreeItem<String>("FILES");
			TreeItem<String> newItem = new TreeItem<String>("condition");
			for (int i = 0; i < files.size(); i++) {
				TreeItem<String> child = new TreeItem<String>(files.get(i).getName());
				newItem.getChildren().add(child);
			}
			Root.getChildren().add(newItem);
	
	    	treeview.setRoot(Root);
		} catch(Exception e) {
			
		}
	}
}
